<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>HA.enemyController.js - The HotAir API</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.7.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.7.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="The HotAir API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/enemyController.html">enemyController</a></li>
            
                <li><a href="..&#x2F;classes/HA.html">HA</a></li>
            
                <li><a href="..&#x2F;classes/mediator.html">mediator</a></li>
            
                <li><a href="..&#x2F;classes/sceneManager.html">sceneManager</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: HA.enemyController.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * The enemyController is responsible for handling the generation of enemy balloons, and the user interaction.
 * @class enemyController 
 *&#x2F;
HA.enemyController = function(ns, $, _, C) {
	
	
  C.bind(&quot;Pause&quot;, function(e) {
    ns.stopProducing();
  });
  C.bind(&quot;UnPause&quot;, function(e) {
    ns.startProducing();
  });
  C.bind(&quot;KeyDown&quot;, function(e) {
    _selectEnemy(e);
  });
  C.bind(&quot;DestroyEnemy&quot;, function(e) {
    _destroyEnemy(e);
  });
  C.bind(&quot;GameOver&quot;, function(e) {
    ns.stopProducing();
  });
    
  &#x2F;&#x2F; Private Scoped Members
  var _producing = false,
    _curEnemy = 0,
    _numEnemies = 0,
    _numEnemiesLeft = null,
    _timer = null,
    _interval = 5000,
    _speed = 1,
    _selectedEnemy = null,
    _tweets = [],
    _enemies = [];
    
  
  
  var _produceEnemy = function() {
    var tweet;
    if (_curEnemy &lt; _numEnemies) {
      if(tweet = _tweets[_curEnemy]) {
        console.log(&quot;tweet: &quot;, tweet);
        _enemies.push(C.e(&quot;Enemy&quot;).setTweet(tweet).setSpeed(_speed));
      }
      if(_curEnemy === 0 || _enemies.length === 1) {
        &#x2F;&#x2F;select the first enemy
        _selectedEnemy = 0;
        _enemies[0].select();
      }
    } else {
      _producing = false;
      clearInterval(_timer);
    }
    _curEnemy += 1;
    console.log(&quot;_produceEnemy&quot;);
  };
  
  var _selectEnemy = function(e) {
    &#x2F;&#x2F; if (_enemies[_selectedEnemy] == undefined) {
      &#x2F;&#x2F; console.log(&quot;Selected Enemy doesn&#x27;t exist!&quot;);
      &#x2F;&#x2F; return;
    &#x2F;&#x2F; }
    &#x2F;&#x2F; set selected enemy
    _setSelectedEnemy();
    
    
    if (e.keyCode === C.keys.DOWN_ARROW) {
      &#x2F;&#x2F; console.log(&quot;KeyDown: DOWN&quot;);
      &#x2F;&#x2F;console.log(&quot;Selected Enemy: &quot;+game.selectedEnemy);
      &#x2F;&#x2F; _enemies[_selectedEnemy].unselect();
      &#x2F;&#x2F; if (_selectedEnemy &lt; _enemies.length-1) {
        &#x2F;&#x2F; _selectedEnemy++;
      &#x2F;&#x2F; } else {
        &#x2F;&#x2F; _selectedEnemy = 0;
      &#x2F;&#x2F; }
      &#x2F;&#x2F; _enemies[_selectedEnemy].select();
      _selectNextEnemy();
      &#x2F;&#x2F; console.log(&quot;game.selectedEnemy: &quot;+game.selectedEnemy);
    } else if(e.keyCode === C.keys.UP_ARROW) {
      &#x2F;&#x2F; console.log(&quot;KeyDown: UP&quot;);
      &#x2F;&#x2F; console.log(&quot;VisibleEnemies length: &quot;+game.Enemies.length);
      &#x2F;&#x2F; console.log(&quot;Selected Enemy: &quot;+game.selectedEnemy);
      &#x2F;&#x2F; _enemies[_selectedEnemy].unselect();
      &#x2F;&#x2F; if (_selectedEnemy &gt; 0) {
        &#x2F;&#x2F; _selectedEnemy--;
      &#x2F;&#x2F; } else {
        &#x2F;&#x2F; _selectedEnemy = _enemies.length-1;
      &#x2F;&#x2F; }
      &#x2F;&#x2F; _enemies[_selectedEnemy].select();
      _selectPreviousEnemy();
      console.log(&quot;game.selectedEnemy: &quot;+_selectedEnemy);
    }
  }
  
  function _selectNextEnemy() {
    _setSelectedEnemy();
    if (_selectedEnemy &lt; _enemies.length-1) {
      _selectedEnemy++;
    } else {
      _selectedEnemy = 0;
    }
    _unselectAllEnemies();
    _enemies[_selectedEnemy].select();
  }
  
  
  function _selectPreviousEnemy() {
    _setSelectedEnemy();
    if (_selectedEnemy &gt; 0) {
      _selectedEnemy--;
    } else {
      _selectedEnemy = _enemies.length-1;
    }
    _unselectAllEnemies();
    _enemies[_selectedEnemy].select();
  }
  
  function _unselectAllEnemies() {
    _.each(_enemies, function(enemy) {
      enemy.unselect();
    });
  }
  function _setSelectedEnemy() {
    var selected = _.find(_enemies, function(enemy, index) {
      if(enemy.selected) _selectedEnemy = index;
      return enemy.selected;
    });
  }
  
  var _destroyEnemy = function(e) {
    var index = _.indexOf(_enemies, e.enemy);
    console.log(&quot;Removing Visible Enemy: &quot;+e.enemy);
    if(index !== -1) {
      &#x2F;&#x2F; game.VisibleEnemies[index].doHit();
      
      &#x2F;&#x2F; _enemies.splice(index, 1);
      &#x2F;&#x2F; if(_enemies[0] !== undefined) {
        &#x2F;&#x2F; _selectedEnemy = 0;
        &#x2F;&#x2F; _enemies[0].select();
      &#x2F;&#x2F; }
      
      console.log(&quot;000000000 _selectedEnemy: &quot;, _selectedEnemy);
      
      if(_enemies[_selectedEnemy] === e.enemy) {
        console.log(&quot;000000000 selected enemy destroyed&quot;);
        _enemies.splice(index, 1);
        if(_enemies[0] !== undefined) {
          _selectedEnemy = 0;
          _enemies[0].select();
        }
      } else {
        _enemies.splice(index, 1);
        console.log(&quot;000000000 unselected enemy destroyed&quot;);
      }
      
      _numEnemiesLeft -= 1;
      console.log(_enemies.length);
      e.enemy.destroy();
    }
    if(_numEnemiesLeft === 0) {
      &#x2F;&#x2F; last enemy is gone, player isn&#x27;t dead... go to next level!
      C.trigger(&quot;LevelComplete&quot;);
    }
  }
  
  
  
  &#x2F;&#x2F; Public interface
  
  &#x2F;**
   * Start producing enemies.  Sets _timer interval.
   * @method startProducing
   * @param {boolean} firstGo If true, indicates that the _produceEnemy method should be invoked immediately.
   *&#x2F;
  ns.startProducing = function(firstGo) {
    console.log(&quot;startProducing&quot;);
    if(firstGo) _produceEnemy();
    _producing = true;
    _timer = setInterval(_produceEnemy, _interval);
  };
  
  &#x2F;**
   * Stop producing enemies.  Clears _timer interval.
   * @method stopProducing
   *&#x2F;
  ns.stopProducing = function() {
    console.log(&quot;stopProducing&quot;);
    _producing = false;
    clearInterval(_timer);
  };
  
  &#x2F;**
   * Destroys all of the existing enemy entities.
   * @method destroyAllEnemies
   *&#x2F;
  ns.destroyAllEnemies = function() {
    _.each(_enemies, function(enemy) {
      enemy.destroy();
    });
  };
  
  &#x2F;**
   * Determine whether or not the enemy controller is currently producing.
   * @method isProducing
   *&#x2F;
  ns.isProducing = function() {
    return _producing;
  };
  
  &#x2F;**
   * Set the speed at which the enemies move.
   * @method setSpeed
   * @param {number} speed The y velocity.
   *&#x2F;
  ns.setSpeed = function(speed) {
    console.log(&quot;setSpeed&quot;);
    _speed = speed;
  };
  
  &#x2F;**
   * Load an set of tweets from the Twitter module.
   * @method loadEnemySet
   * @param {number} start
   * @param {number} count
   *&#x2F;
  ns.loadEnemySet = function(start, count) {
    _tweets = HA.Twitter.getTweetSet(start, count);
    _curEnemy = 0;
    _numEnemies = _numEnemiesLeft = _tweets.length;
  };
	
	return ns;
	
}(HA.namespace(&quot;HA.enemyController&quot;), jQuery, _, Crafty);
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
